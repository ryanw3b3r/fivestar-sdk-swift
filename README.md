# FiveStar Support SDK for Swift

[![Swift](https://img.shields.io/badge/Swift-5.9+-orange.svg)](https://swift.org)
[![Platform](https://img.shields.io/badge/platform-iOS%20%7C%20macOS%20%7C%20watchOS%20%7C%20tvOS-lightgrey.svg)](https://developer.apple.com)

Swift SDK for integrating FiveStar Support feedback collection into your iOS, macOS, watchOS, or tvOS applications.

## Features

- **Server-Side Customer ID Generation**: Secure customer IDs generated by the server
- **Response Types**: Fetch available feedback categories (bug, feature request, etc.)
- **Feedback Submission**: Submit bug reports and feature requests
- **Type-Safe Models**: Swift `Codable` for full type safety
- **Modern async/await**: Native Swift concurrency

## Requirements

- Swift 5.9+
- iOS 13.0+ / macOS 10.15+ / watchOS 6.0+ / tvOS 13.0+

## Installation

### Swift Package Manager

Add the package to your project in Xcode:

1. File â†’ Add Package Dependencies
2. Enter the repository URL
3. Add `FiveStarSupport` to your target

Or add it to your `Package.swift`:

```swift
dependencies: [
    .package(url: "https://github.com/ryanw3b3r/fivestar-sdk-swift.git", from: "1.1.0")
]
```

## Quick Start

```swift
import FiveStarSupport

// Initialize the client
let client = FiveStarClient(
    clientId: "your-client-id",
    platform: "ios",              // 'web', 'ios', 'android', 'flutter', 'laravel'
    appVersion: "1.0.0"
)

// Generate a customer ID from the server
let result = try await client.generateCustomerId()
let customerId = result.customerId

// Register the customer
let customerResult = try await client.registerCustomer(
    customerId: customerId,
    options: RegisterCustomerOptions(email: "user@example.com", name: "John Doe")
)

if customerResult.success {
    print("Customer registered: \(customerResult.customer?.customerId ?? "")")
}

// Get available response types
let types = try await client.getResponseTypes()

// Submit feedback
let response = try await client.submitResponse(options: SubmitResponseOptions(
    customerId: customerId,
    title: "App crashes on launch",
    description: "The app crashes immediately after opening",
    typeId: types.first!.id
))

print("Response submitted: \(response.responseId)")
```

## Usage

### Initialization

```swift
let client = FiveStarClient(
    clientId: "your-client-id",
    apiUrl: "https://fivestar.support",  // optional
    platform: "ios",                      // optional: 'web', 'ios', 'android', etc.
    appVersion: "1.0.0",                  // optional
    deviceModel: "iPhone14,2",            // optional
    osVersion: "16.0"                     // optional
)
```

### Generate Customer ID

Customer IDs are now generated server-side with cryptographic signing:

```swift
let result = try await client.generateCustomerId()

print("Customer ID: \(result.customerId)")
print("Expires At: \(result.expiresAt)")
print("Device ID: \(result.deviceId)")
```

### Register Customer

```swift
try await client.registerCustomer(
    customerId: customerId,
    options: RegisterCustomerOptions(email: "user@example.com", name: "John Doe")
)
```

### Get Response Types

```swift
let types = try await client.getResponseTypes()
// Returns: [ResponseType] with id, name, slug, color, icon
```

### Submit Feedback

```swift
let response = try await client.submitResponse(options: SubmitResponseOptions(
    customerId: customerId,
    title: "Feature Request: Dark mode",
    description: "Please add dark mode support",
    typeId: types.first!.id
))
```

### Verify Customer ID

```swift
let result = try await client.verifyCustomer(customerId: customerId)

if result.valid {
    print("Customer ID is valid and registered")
} else {
    print("Verification failed: \(result.message ?? "")")
}
```

### Public URL Generation

```swift
// Default (no locale)
let url = client.getPublicUrl()
// => "https://fivestar.support/c/your-client-id"

// With locale
let localizedUrl = client.getPublicUrl(locale: "fr")
// => "https://fivestar.support/fr/c/your-client-id"
```

## API Reference

### FiveStarClient

Main client for interacting with the FiveStar Support API.

#### Initialization

```swift
let client = FiveStarClient(
    clientId: "your-client-id",
    apiUrl: "https://fivestar.support",  // optional
    platform: "ios",                      // optional
    appVersion: "1.0.0",                  // optional
    deviceModel: "iPhone14,2",            // optional
    osVersion: "16.0"                     // optional
)
```

| Parameter     | Type      | Default                      | Description         |
| ------------- | --------- | ---------------------------- | ------------------- |
| `clientId`    | `String`  | _required_                   | Your client UUID    |
| `apiUrl`      | `String?` | `"https://fivestar.support"` | API base URL        |
| `platform`    | `String?` | `nil`                        | Platform identifier |
| `appVersion`  | `String?` | `nil`                        | App version string  |
| `deviceModel` | `String?` | `nil`                        | Device model        |
| `osVersion`   | `String?` | `nil`                        | OS version          |

#### Methods

| Method                                  | Description                            |
| --------------------------------------- | -------------------------------------- |
| `getResponseTypes()`                    | Get all available response types       |
| `generateCustomerId()`                  | Generate a new customer ID from server |
| `registerCustomer(customerId:options:)` | Register a customer ID                 |
| `verifyCustomer(customerId:)`           | Verify a customer ID                   |
| `submitResponse(options:)`              | Submit a new response/feedback         |
| `getPublicUrl(locale:)`                 | Get public feedback page URL           |

### Data Models

#### GenerateCustomerIdResult

```swift
public struct GenerateCustomerIdResult {
    public let customerId: String    // The server-generated customer ID
    public let expiresAt: String     // ISO datetime when ID expires
    public let deviceId: String       // Short device identifier
}
```

#### RegisterCustomerOptions

```swift
public struct RegisterCustomerOptions {
    public let email: String?  // Optional: Customer email
    public let name: String?   // Optional: Customer name
}
```

#### SubmitResponseOptions

```swift
public struct SubmitResponseOptions {
    public let customerId: String     // Required: Customer ID
    public let title: String          // Required: Feedback title
    public let description: String    // Required: Feedback description
    public let typeId: String         // Required: Response type ID
    public let email: String?         // Optional: Customer email
    public let name: String?          // Optional: Customer name
}
```

#### VerifyCustomerResult

```swift
public struct VerifyCustomerResult {
    public let valid: Bool            // Whether the customer ID is valid
    public let message: String?       // Optional message
}
```

#### ResponseType

```swift
public struct ResponseType {
    public let id: String
    public let name: String
    public let slug: String
    public let color: String
    public let icon: String
}
```

## Error Handling

All methods can throw `FiveStarAPIError`:

```swift
do {
    let types = try await client.getResponseTypes()
} catch let error as FiveStarAPIError {
    print("API Error: \(error.message)")
    if let statusCode = error.statusCode {
        print("Status Code: \(statusCode)")
    }
}
```

### Customer ID Generation

```swift
let result = try await client.generateCustomerId()
let customerId = result.customerId
```

### Registration

```swift
// Same API, but customerId now comes from server
try await client.registerCustomer(
    customerId: customerId,
    options: RegisterCustomerOptions(email: "user@example.com", name: "John Doe")
)
```

## License

MIT License - see LICENSE file for details.

## Support

- Documentation: https://fivestar.support
- GitHub Issues: https://github.com/ryanw3b3r/fivestar-sdk-swift/issues
